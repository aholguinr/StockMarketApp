<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Analysis</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
</head>
<body>
    <div class="container mt-5">
        <h1>Test de Análisis Individual</h1>
        
        <!-- Basic form elements -->
        <form id="stockAnalysisForm">
            <div class="mb-3">
                <label for="stockSymbol" class="form-label">Símbolo de Acción</label>
                <input type="text" class="form-control" id="stockSymbol" value="AAPL">
            </div>
            <div class="mb-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="detailedOutput" checked>
                    <label class="form-check-label" for="detailedOutput">Análisis Detallado</label>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <select class="form-select" id="periodNumber">
                        <option value="6" selected>6</option>
                    </select>
                </div>
                <div class="col-6">
                    <select class="form-select" id="periodUnit">
                        <option value="mo" selected>Meses</option>
                    </select>
                </div>
            </div>
            <button type="submit" class="btn btn-primary mt-3" id="analyzeBtn">Analizar</button>
        </form>
        
        <!-- Loading spinner -->
        <div id="loadingSpinner" style="display: none;" class="mt-3">
            <div class="spinner-border" role="status"></div>
            <span>Cargando...</span>
        </div>
        
        <!-- Results section -->
        <div id="singleResultsSection" style="display: none;" class="mt-4">
            <div class="card">
                <div class="card-body" id="summaryContent">
                    <!-- Summary will be here -->
                </div>
            </div>
            <div class="card mt-3" id="detailedCard" style="display: none;">
                <div class="card-body" id="detailedContent">
                    <!-- Details will be here -->
                </div>
            </div>
        </div>
        
        <!-- Error alert -->
        <div id="errorAlert" style="display: none;" class="mt-3">
            <div class="alert alert-danger">
                <span id="errorMessage"></span>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Test script -->
    <script>
        // Simplified version of the main script for testing
        const API_BASE_URL = 'http://localhost:8000';
        
        let stockForm, loadingSpinner, singleResultsSection, errorAlert, detailedCard;
        let analyzeBtn;
        
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Test page initialized');
            
            // Initialize elements
            stockForm = document.getElementById('stockAnalysisForm');
            loadingSpinner = document.getElementById('loadingSpinner');
            singleResultsSection = document.getElementById('singleResultsSection');
            errorAlert = document.getElementById('errorAlert');
            detailedCard = document.getElementById('detailedCard');
            analyzeBtn = document.getElementById('analyzeBtn');
            
            console.log('Elements found:', {
                stockForm: !!stockForm,
                loadingSpinner: !!loadingSpinner,
                singleResultsSection: !!singleResultsSection,
                errorAlert: !!errorAlert,
                analyzeBtn: !!analyzeBtn
            });
            
            if (stockForm) {
                stockForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    console.log('Form submitted - testing basic functionality');
                    
                    // Test basic element access
                    try {
                        showLoading(true);
                        setTimeout(() => {
                            showLoading(false);
                            showError('Test completado - elementos funcionando correctamente');
                        }, 2000);
                    } catch (error) {
                        console.error('Error en test:', error);
                    }
                });
            }
        });
        
        function showLoading(show) {
            console.log('showLoading called:', show);
            if (loadingSpinner) {
                loadingSpinner.style.display = show ? 'block' : 'none';
                console.log('Loading spinner updated');
            } else {
                console.error('Loading spinner not found');
            }
            
            if (analyzeBtn) {
                analyzeBtn.disabled = show;
                analyzeBtn.innerHTML = show ? 'Analizando...' : 'Analizar';
                console.log('Analyze button updated');
            } else {
                console.error('Analyze button not found');
            }
        }
        
        function showError(message) {
            console.log('showError called:', message);
            const errorMessage = document.getElementById('errorMessage');
            if (errorMessage) {
                errorMessage.textContent = message;
                console.log('Error message set');
            } else {
                console.error('Error message element not found');
            }
            
            if (errorAlert) {
                errorAlert.style.display = 'block';
                console.log('Error alert shown');
            } else {
                console.error('Error alert not found');
            }
        }
    </script>
</body>
</html>